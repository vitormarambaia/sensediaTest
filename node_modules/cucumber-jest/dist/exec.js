"use strict";

var _Object$defineProperty = require("@babel/runtime-corejs3/core-js-stable/object/define-property");

var _interopRequireDefault = require("@babel/runtime-corejs3/helpers/interopRequireDefault");

_Object$defineProperty(exports, "__esModule", {
  value: true
});

exports.exec = exec;

var _some = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/some"));

var _forEach = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/for-each"));

var _path = _interopRequireDefault(require("path"));

var _support_code_library_builder = _interopRequireDefault(require("@cucumber/cucumber/lib/support_code_library_builder"));

var _suite = require("./parsers/suite");

const options = _support_code_library_builder.default.finalize();

let hasReactDom = false;
/** check if react exists */

try {
  hasReactDom = !!require('react-dom');
} catch (e) {//
}

function exec(cwd, featurePath, moduleFileExtensions) {
  var _context;

  const act = typeof global['window'] === 'undefined' || !hasReactDom ? async fn => await fn() : require('react-dom/test-utils').act; // parse the feature file with given cucumber steps / hooks
  // generating a jasmine-like structure

  const spec = (0, _suite.parseSuite)(cwd, featurePath, moduleFileExtensions, options);

  const fileName = _path.default.basename(featurePath, _path.default.extname(featurePath));

  const hasSomeActiveSuites = (0, _some.default)(_context = spec.suites).call(_context, suite => !suite.skip);
  const shouldSkipSuite = spec.skip || !hasSomeActiveSuites;
  const fn = shouldSkipSuite ? xdescribe || describe.skip : describe;
  fn(`Feature: ${spec.document.name}`, () => {
    var _context2;

    let world;
    beforeAll(async () => {
      world = new options.World({});

      for (let i = 0; i < spec.beforeAll.length; i++) {
        await act(async () => {
          await spec.beforeAll[i].code.apply(world, [spec, fileName]);
        });
      }
    });
    afterAll(async () => {
      for (let i = 0; i < spec.afterAll.length; i++) {
        await act(async () => {
          await spec.afterAll[i].code.apply(world, [spec, fileName]);
        });
      }

      world = null;
    });
    (0, _forEach.default)(_context2 = spec.suites).call(_context2, suite => {
      const fn = suite.skip ? xdescribe || describe.skip : describe;
      fn(`${suite.keyword}: ${suite.name}`, () => {
        beforeAll(async () => {
          for (let i = 0; i < spec.beforeEach.length; i++) {
            await act(async () => {
              await spec.beforeEach[i].code.apply(world, [{
                spec,
                suite: suite
              }, fileName]);
            });
          }
        });
        afterAll(async () => {
          for (let i = 0; i < spec.afterEach.length; i++) {
            await act(async () => {
              await spec.afterEach[i].code.apply(world, [{
                spec,
                suite: suite
              }, fileName]);
            });
          }
        });

        for (let i = 0; i < suite.steps.given.length; i++) {
          it(suite.steps.given[i].keyword + suite.steps.given[i].text, async () => {
            await suite.steps.given[i].code.apply(world, suite.steps.given[i].stepArgs);
          });
        }

        for (let i = 0; i < suite.steps.when.length; i++) {
          it(suite.steps.when[i].description, async () => {
            await suite.steps.when[i].code.apply(world, suite.steps.when[i].stepArgs);
          });
        }

        for (let i = 0; i < suite.steps.then.length; i++) {
          it(suite.steps.then[i].description, async () => {
            await suite.steps.then[i].code.apply(world, suite.steps.then[i].stepArgs);
          });
        }
      });
    });
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9leGVjLnRzIl0sIm5hbWVzIjpbIm9wdGlvbnMiLCJzdXBwb3J0Q29kZUxpYnJhcnlCdWlsZGVyIiwiZmluYWxpemUiLCJoYXNSZWFjdERvbSIsInJlcXVpcmUiLCJlIiwiZXhlYyIsImN3ZCIsImZlYXR1cmVQYXRoIiwibW9kdWxlRmlsZUV4dGVuc2lvbnMiLCJhY3QiLCJnbG9iYWwiLCJmbiIsInNwZWMiLCJmaWxlTmFtZSIsInBhdGgiLCJiYXNlbmFtZSIsImV4dG5hbWUiLCJoYXNTb21lQWN0aXZlU3VpdGVzIiwic3VpdGVzIiwic3VpdGUiLCJza2lwIiwic2hvdWxkU2tpcFN1aXRlIiwieGRlc2NyaWJlIiwiZGVzY3JpYmUiLCJkb2N1bWVudCIsIm5hbWUiLCJ3b3JsZCIsImJlZm9yZUFsbCIsIldvcmxkIiwiaSIsImxlbmd0aCIsImNvZGUiLCJhcHBseSIsImFmdGVyQWxsIiwia2V5d29yZCIsImJlZm9yZUVhY2giLCJhZnRlckVhY2giLCJzdGVwcyIsImdpdmVuIiwiaXQiLCJ0ZXh0Iiwic3RlcEFyZ3MiLCJ3aGVuIiwiZGVzY3JpcHRpb24iLCJ0aGVuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBRUE7O0FBRUE7O0FBRUEsTUFBTUEsT0FBTyxHQUFHQyxzQ0FBMEJDLFFBQTFCLEVBQWhCOztBQUVBLElBQUlDLFdBQVcsR0FBRyxLQUFsQjtBQUVBOztBQUNBLElBQUk7QUFDQUEsRUFBQUEsV0FBVyxHQUFHLENBQUMsQ0FBQ0MsT0FBTyxDQUFDLFdBQUQsQ0FBdkI7QUFDSCxDQUZELENBRUUsT0FBT0MsQ0FBUCxFQUFVLENBQ1I7QUFDSDs7QUFFTSxTQUFTQyxJQUFULENBQ0hDLEdBREcsRUFFSEMsV0FGRyxFQUdIQyxvQkFIRyxFQUlMO0FBQUE7O0FBQ0UsUUFBTUMsR0FBRyxHQUNMLE9BQU9DLE1BQU0sQ0FBQyxRQUFELENBQWIsS0FBNEIsV0FBNUIsSUFBMkMsQ0FBQ1IsV0FBNUMsR0FDTSxNQUFPUyxFQUFQ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RUFBZ0JBLENBQUMsR0FBR1YsS0FBSyxDQUFDa0IsS0FBTixDQUFZSyxJQUFaLENBQWlCWixNQUFyQyxFQUE2Q0QsQ0FBQyxFQUE5QyxFQUFrRDtBQUM5Q1UsVUFBQUEsRUFBRSxDQUFDcEIsS0FBSyxDQUFDa0IsS0FBTixDQUFZSyxJQUFaLENBQWlCYixDQUFqQixFQUFvQmMsV0FBckIsRUFBa0MsWUFBWTtBQUM1QyxrQkFBTXhCLEtBQUssQ0FBQ2tCLEtBQU4sQ0FBWUssSUFBWixDQUFpQmIsQ0FBakIsRUFBb0JFLElBQXBCLENBQXlCQyxLQUF6QixDQUNGTixLQURFLEVBRUZQLEtBQUssQ0FBQ2tCLEtBQU4sQ0FBWUssSUFBWixDQUFpQmIsQ0FBakIsRUFBb0JZLFFBRmxCLENBQU47QUFJSCxXQUxDLENBQUY7QUFNSDs7QUFFRCxhQUFLLElBQUlaLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdWLEtBQUssQ0FBQ2tCLEtBQU4sQ0FBWU8sSUFBWixDQUFpQmQsTUFBckMsRUFBNkNELENBQUMsRUFBOUMsRUFBa0Q7QUFDOUNVLFVBQUFBLEVBQUUsQ0FBQ3BCLEtBQUssQ0FBQ2tCLEtBQU4sQ0FBWU8sSUFBWixDQUFpQmYsQ0FBakIsRUFBb0JjLFdBQXJCLEVBQWtDLFlBQVk7QUFDNUMsa0JBQU14QixLQUFLLENBQUNrQixLQUFOLENBQVlPLElBQVosQ0FBaUJmLENBQWpCLEVBQW9CRSxJQUFwQixDQUF5QkMsS0FBekIsQ0FDRk4sS0FERSxFQUVGUCxLQUFLLENBQUNrQixLQUFOLENBQVlPLElBQVosQ0FBaUJmLENBQWpCLEVBQW9CWSxRQUZsQixDQUFOO0FBSUgsV0FMQyxDQUFGO0FBTUg7QUFDSixPQXJEQyxDQUFGO0FBc0RILEtBekREO0FBMERILEdBakZDLENBQUY7QUFrRkgiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuaW1wb3J0IHN1cHBvcnRDb2RlTGlicmFyeUJ1aWxkZXIgZnJvbSAnQGN1Y3VtYmVyL2N1Y3VtYmVyL2xpYi9zdXBwb3J0X2NvZGVfbGlicmFyeV9idWlsZGVyJztcblxuaW1wb3J0IHtwYXJzZVN1aXRlfSBmcm9tICcuL3BhcnNlcnMvc3VpdGUnO1xuXG5jb25zdCBvcHRpb25zID0gc3VwcG9ydENvZGVMaWJyYXJ5QnVpbGRlci5maW5hbGl6ZSgpO1xuXG5sZXQgaGFzUmVhY3REb20gPSBmYWxzZTtcblxuLyoqIGNoZWNrIGlmIHJlYWN0IGV4aXN0cyAqL1xudHJ5IHtcbiAgICBoYXNSZWFjdERvbSA9ICEhcmVxdWlyZSgncmVhY3QtZG9tJyk7XG59IGNhdGNoIChlKSB7XG4gICAgLy9cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGV4ZWMoXG4gICAgY3dkOiBzdHJpbmcsXG4gICAgZmVhdHVyZVBhdGg6IHN0cmluZyxcbiAgICBtb2R1bGVGaWxlRXh0ZW5zaW9uczogc3RyaW5nW11cbikge1xuICAgIGNvbnN0IGFjdCA9XG4gICAgICAgIHR5cGVvZiBnbG9iYWxbJ3dpbmRvdyddID09PSAndW5kZWZpbmVkJyB8fCAhaGFzUmVhY3REb21cbiAgICAgICAgICAgID8gYXN5bmMgKGZuKSA9PiBhd2FpdCBmbigpXG4gICAgICAgICAgICA6IHJlcXVpcmUoJ3JlYWN0LWRvbS90ZXN0LXV0aWxzJykuYWN0O1xuXG4gICAgLy8gcGFyc2UgdGhlIGZlYXR1cmUgZmlsZSB3aXRoIGdpdmVuIGN1Y3VtYmVyIHN0ZXBzIC8gaG9va3NcbiAgICAvLyBnZW5lcmF0aW5nIGEgamFzbWluZS1saWtlIHN0cnVjdHVyZVxuICAgIGNvbnN0IHNwZWMgPSBwYXJzZVN1aXRlKGN3ZCwgZmVhdHVyZVBhdGgsIG1vZHVsZUZpbGVFeHRlbnNpb25zLCBvcHRpb25zKTtcblxuICAgIGNvbnN0IGZpbGVOYW1lID0gcGF0aC5iYXNlbmFtZShmZWF0dXJlUGF0aCwgcGF0aC5leHRuYW1lKGZlYXR1cmVQYXRoKSk7XG5cbiAgICBjb25zdCBoYXNTb21lQWN0aXZlU3VpdGVzID0gc3BlYy5zdWl0ZXMuc29tZSgoc3VpdGUpID0+ICFzdWl0ZS5za2lwKTtcblxuICAgIGNvbnN0IHNob3VsZFNraXBTdWl0ZSA9IHNwZWMuc2tpcCB8fCAhaGFzU29tZUFjdGl2ZVN1aXRlcztcblxuICAgIGNvbnN0IGZuID0gc2hvdWxkU2tpcFN1aXRlID8geGRlc2NyaWJlIHx8IGRlc2NyaWJlLnNraXAgOiBkZXNjcmliZTtcblxuICAgIGZuKGBGZWF0dXJlOiAke3NwZWMuZG9jdW1lbnQubmFtZX1gLCAoKSA9PiB7XG4gICAgICAgIGxldCB3b3JsZDtcblxuICAgICAgICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgd29ybGQgPSBuZXcgb3B0aW9ucy5Xb3JsZCh7fSk7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3BlYy5iZWZvcmVBbGwubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBhY3QoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBzcGVjLmJlZm9yZUFsbFtpXS5jb2RlLmFwcGx5KHdvcmxkLCBbc3BlYywgZmlsZU5hbWVdKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgYWZ0ZXJBbGwoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzcGVjLmFmdGVyQWxsLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgYWN0KGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc3BlYy5hZnRlckFsbFtpXS5jb2RlLmFwcGx5KHdvcmxkLCBbc3BlYywgZmlsZU5hbWVdKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgd29ybGQgPSBudWxsO1xuICAgICAgICB9KTtcblxuICAgICAgICBzcGVjLnN1aXRlcy5mb3JFYWNoKChzdWl0ZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZm4gPSBzdWl0ZS5za2lwID8geGRlc2NyaWJlIHx8IGRlc2NyaWJlLnNraXAgOiBkZXNjcmliZTtcblxuICAgICAgICAgICAgZm4oYCR7c3VpdGUua2V5d29yZH06ICR7c3VpdGUubmFtZX1gLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzcGVjLmJlZm9yZUVhY2gubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGFjdChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc3BlYy5iZWZvcmVFYWNoW2ldLmNvZGUuYXBwbHkod29ybGQsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3NwZWMsIHN1aXRlOiBzdWl0ZX0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVOYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgYWZ0ZXJBbGwoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNwZWMuYWZ0ZXJFYWNoLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBhY3QoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNwZWMuYWZ0ZXJFYWNoW2ldLmNvZGUuYXBwbHkod29ybGQsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3NwZWMsIHN1aXRlOiBzdWl0ZX0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVOYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdWl0ZS5zdGVwcy5naXZlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpdChcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1aXRlLnN0ZXBzLmdpdmVuW2ldLmtleXdvcmQgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1aXRlLnN0ZXBzLmdpdmVuW2ldLnRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc3VpdGUuc3RlcHMuZ2l2ZW5baV0uY29kZS5hcHBseShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29ybGQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1aXRlLnN0ZXBzLmdpdmVuW2ldLnN0ZXBBcmdzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN1aXRlLnN0ZXBzLndoZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaXQoc3VpdGUuc3RlcHMud2hlbltpXS5kZXNjcmlwdGlvbiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc3VpdGUuc3RlcHMud2hlbltpXS5jb2RlLmFwcGx5KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmxkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1aXRlLnN0ZXBzLndoZW5baV0uc3RlcEFyZ3NcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3VpdGUuc3RlcHMudGhlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpdChzdWl0ZS5zdGVwcy50aGVuW2ldLmRlc2NyaXB0aW9uLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBzdWl0ZS5zdGVwcy50aGVuW2ldLmNvZGUuYXBwbHkoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd29ybGQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VpdGUuc3RlcHMudGhlbltpXS5zdGVwQXJnc1xuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuIl19